name: Check for IANA special-purpose address registry updates

on:
  schedule:
    - cron: "20 16 * * *"

jobs:
  check-iana-registries:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout iana/data from main branch
        uses: actions/checkout@v4
        with:
            sparse-checkout: iana/data

      # TODO(#8080): Instead of just failing the job, create a PR.
      - name: Check and fail if IANA special-purpose address registries have changed
        run: |
            set -e

            IANA_IPV4="https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry-1.csv"
            IANA_IPV6="https://www.iana.org/assignments/iana-ipv6-special-registry/iana-ipv6-special-registry-1.csv"

            REPO_IPV4="iana/data/iana-ipv4-special-registry-1.csv"
            REPO_IPV6="iana/data/iana-ipv6-special-registry-1.csv"

            diff -u "${REPO_IPV4}" <(curl "${IANA_IPV4}") >&2
            diff -u "${REPO_IPV6}" <(curl "${IANA_IPV6}") >&2
        shell: bash
